## Introduction to Cross-Ancestry PRS analysis

### Before starting the practical the following commands will need to be run from within your virtual machine:


**Scenario 1: European Sumstats and African Target Data**
---------------------------------------------------------

**Create configuration file for the target-only analysis**

```
./bridgePRS check pop -o out_config-AFR-single --pop AFR --sumstats_prefix data/pop_africa/sumstats/eur.chr --genotype_prefix data/pop_africa/genotypes/afr_genotypes --phenotype_file data/pop_africa/phenotypes/afr_pheno.dat
```


**Questions**

1. What 2 peices of information have been inferred by the BRIDGE software?

2. How many phenotypes have been identified in the pheno file? in what way do the 2 phenotypes differ?

3. Which files have been generated?

4. Make a note of the resulting output files stored in ./out/save/ and then proceed to the next steps


**Tasks**

In order to run next code snippet:

- Provide a pathname to specify the location of the configuration file.

- Swap the phenotype to the continuous version of the trait.

- Now that we have our African configuration file prepared we are ready to perform a single-ancestry BRIDGE analysis


**Single ancestry BRIDGEPRS analysis:**

```
./bridgePRS prs-single run -o out_bridge-AFR-single --pop africa --config_files /sc/arion/projects/psychgen/projects/iyegbc01/BRIDGEPRS_WCS_2024/BridgePRS-TOY/out_config-AFR-single/save/primary.AFR.config --phenotype y
```


**Task**

Review which steps have been completed by checking the information contained in _BridgePRS-TOY/out\_again/prs-single\_AFRICA_ and 
opening file bridge.prs-single.result


**Questions**

5. Which steps of the Bridge analysis successfully executed?

6. What information can be found in BridgePRS-TOY/out\_again/prs-single\_AFRICA/quantify/AFRICA\_quantify\_preds.dat ?

7. What information can be found in AFRICA\_quantify\_var\_explained.txt ?



Scenario 2: European and African Sumstats Against African Target Data
---------------------------------------------------------------------


**Create configuration file for base and target populations**

```
./bridgePRS check pops -o out_config-EUR-AFR-easyrun --pop AFR EUR --sumstats_prefix data/pop_africa/sumstats/afr.chr data/pop_europe/sumstats/eur.chr --sumstats_suffix .glm.linear.gz .glm.linear.gz --genotype_prefix data/pop_africa/genotypes/afr_genotypes --phenotype_file data/pop_africa/phenotypes/afr_pheno.dat --covariates PC1,PC2 --snp_file
```


**Question**

8. In which file would you expect to find information on covariates?


**Tasks**
Do the following:

- Delete any redundant flag inputs from the example code above and run the command.

- Run the code.

- Make a note of the output files produced.


**Question**

9. Which additional files have been produced, compared to the output of the single-ancestry analysis?


**Multi-ancestry BRIDGEPRS analysis:**
- Based on your newly-recent understanding of genetic distances between continental populations, choose a sensible    
  value to enter after the _--fst_ flag below.
```
./bridgePRS easyrun go -o out_easyrun-EUR-AFR --config_files out_config-EUR-AFR-easyrun/save/target.AFR.config out_config-EUR-AFR-easyrun/save/base.EUR.config --fst --phenotype y
```


**Tasks**

- Run the multi-ancestry Bridge command.

- Read the on-screen output generated by the running of the easyrun command to answer the next set of questions.


**Questions**

10. What is the number of SNP overlaps with the QCed SNP set in each population?

11. How many cores were used versus those that are available?

12. Which flag could we use to increase the number of cores if needed?

13. What format should used to enter effect sizes for binary traits?

**Short Quiz**
I have GWAS data and genotype/phenotype data for a cohort consisting of >2000 samples from a small East European population. 
The population LD structure is unique and so I would like this information to be incorporated into my PRS prediction model. I additionally have GWAS and genotype/phenotype data from the UKB biobank that I want to include. How do I formulate the relevant Config files for the BridgePRS analysis?

**File types**
```
ukr/sumstats/ukr.sumstats.out
ukr/genotypes/chr1.bed,bim,fam...chr22.bed,bin,fam,
ukr/phenotypes/ukr_test.dat, ukr/phenotypes/ukr_validation.dat
ukb/sumstats/ukb.sumstats.gz
ukb/genotypes/chr1.bed,bim,fam...chr22.bed,bin,fam
ukb/phenotypes/ukb_test.dat, ukb/phenotypes/ukb_validation.dat
```
**Answer**
```
Target config:
POP=
LDPOP=
SUMSTATS_PREFIX=
GENOTYPE_PREFIX=
PHENOTYPE_FILE=
VALIDATION_FILE=

Model config file:
POP=
LDPOP=
SUMSTATS_PREFIX=
GENOTYPE_PREFIX=
PHENOTYPE_FILE=
VALIDATION_FILE=
```

